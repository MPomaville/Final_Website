---
title: Third Graph - Are all continents approaching the global mean life expectancy?
author: Matt Pomaville
date: '2018-06-13'
slug: third-graph-are-all-continents-approaching-the-global-mean-life-expectancy
categories:
  - CS631
  - R
tags:
  - ggplot
description: Desc
hacker_news_id: ''
lobsters_id: ''
meta_img: /images/image.jpg
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
#Life expectancy by continent vs. global mean life expectancy graph brief

This is a brief describing the graph created from the gapminder dataset. It is available as a CRAN Package by installing `gapminder` and calling `library(gapminder)` during setup. 

##Load required libraries
To make this graph I used the `tidyverse`, `gapminder`, and `wesanderson` libraries.

```{r message = FALSE}
library(tidyverse)
library(gapminder)
library(wesanderson)
```

In this visalization I want to examine the relative number of countries in each continent with life expectancies over themean life expectancy in 2007 by year.

#Analyzing the Graph
##Type of Graph
The graph presented is a grouped bar graph. 


##Data used
The data for this graph came from the `gapminder` R package generated by Jennifer Bryan and available from CRAN.

##Cleaning up the gapminder data
###Getting the global mean life expectancy in 2007

I first need to filter for only the 2007 data and get the mean across all nations.
```{r results = 'hide'}
gapminder_2007 <- gapminder %>% 
  filter(year == 2007)

gapminder_2007 %>% 
  summarize(mean(lifeExp))
```

The mean life expectancy for all nations was `r gapminder_2007 %>% summarize(mean(lifeExp))

###Getting the continental mean life expectancy and number of countries in each continent

Next, I needed to get the mean life expectancy and number of countries in each continent for each year.

```{r}
#The only way I can think to get the number of countries over the world 2007 mean is to add a column to `gapminder` with a 1 if the value is over the mean and a 0 if its less, then summing that column when I pull the mean and the total countries...
gapminder_cont_mean <- gapminder %>% 
  mutate(over_mean = if_else(lifeExp >= 67, 1, 0))  %>% 
  group_by(year, continent) %>% 
  summarize(mean(lifeExp), n(), sum(over_mean)) %>% 
  ungroup()

colnames(gapminder_cont_mean) <- c("year", "continent", "mean_lifeExp", "total_countries", "over_mean")
```

###Getting the proportion of countries over the global mean
This code adds a column with the proportion of countries in a continent over the 2007 global mean in a given year.

```{r}
gapminder_cont_mean <- gapminder_cont_mean %>% 
  mutate(prop_over = over_mean/total_countries) %>% 
  mutate(year = as.factor(year))
```

###Information about `gapminder_cont_mean`
The data frame `gapminder_cont_mean` has 6 columns:

* year - The year the data was collected in
* continent - The content the data was collected on/for
* mean_lifeExp - The mean of the life expectanceis across countries on a continent for a given year
* total_countries - The number of countries on a continent in a given year
* over_mean - The total number of countries with mean life expectancy over the 2007 global mean in a given year
* prop_over - The proportion of countries with mean life expectancy over the 2007 mean in a given year. Gotten by dividing `over_mean` by `total_countries`.

##Audience
The graph is designed for general consumption, particularly by individuals interested in population trends across time. THere are no elements of this graph that would be uninterperable to someone with a general understanding of population growth.

##Description
This graph shows the proportion of countries on each continent with a mean life expectancy over the global mean life expectancy in 2007 on the x-axis, grouped by year on the y-axis. The general trend is that all continents are approaching the 2007 global mean, but that some continents are approaching all countries being at or over the global mean faster than others. For example, Oceania has been over the global mean from the first data collected in 1952, while Africa only has a small number of countries near at the global mean in 2007.

###How to read it
When approaching this graph, it is helpful to look at the trends both within x-axis groups and across the whole data set. For example, it may be useful to see how the difference in proportion between Europs and Asia has changed across the entire graph.

###Annotation and Presentation
Annotations coule be used to mark years with specific events that could effect the mean life expectancy for a continent, such as a famine, war, or disease. Color is used in this version to denote countries.

###Variations
This same data coule be shown with a series of boxplots using and a line at the global 2007 mean. In fact, that plot may be more informative because it would show how more information about the values of each country rather than a simple binary value of "yes they are at or above the mean" or "no they are not at or above the mean".

##Methods
##Making the graph
The graph is made from the `gapminder_cont_mean` data frame generated above.

```{r }
life_exp <- ggplot(gapminder_cont_mean, aes(x = year, y = prop_over, fill = continent))+
                     geom_bar(position = "dodge", stat = "identity")+
  ggtitle("How close is each continent to the global mean life expectancy?")+
  labs(subtitle = "Proportion of countries per continent with life expectancies \ngreater than or equal to the 2007 world mean", x = "Year", y = "Proportion of countries over the 2007 mean", fill = "Continent")+
  scale_fill_manual(values = wes_palette("Darjeeling1"))+
  theme_bw()
```

To make the graph I generated a general ggplot object calles `life_exp` from the `gapminder_cont_mean` data frame. It uses `year` as the x-axis value and `prop_over` as the y-axis value. It also adds fill color to the bars based on `continent`.
I then applied a `geom_bar` layer to the object, specifying that the bars would be arranged adjacently and would have no further statistical processing applied. 
Finally, I added a title, subtitle, axis and legend titles, and changed the default colors to use colors from the `wesanderson` package `Darjeeling` palette.

```{r}
life_exp
```